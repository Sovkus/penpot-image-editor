<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Image Editor</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 20px; border-radius: 8px; max-width: 500px; margin: 0 auto; }
        h1 { color: #2680eb; margin-bottom: 15px; }
        .preview { width: 208px; height: 208px; background: #e0e0e0; border-radius: 8px; margin: 20px auto; display: flex; align-items: center; justify-content: center; }
        .control { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="range"] { width: 100%; }
        .value { float: right; color: #666; }
        .buttons { display: flex; gap: 10px; margin-top: 20px; }
        button { flex: 1; padding: 10px; border: none; border-radius: 5px; cursor: pointer; }
        #reset { background: #e0e0e0; }
        #apply { background: #2680eb; color: white; }
        #status { margin-top: 10px; text-align: center; color: #666; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸŽ¨ Image Editor</h1>
        <p>Select an image in Penpot to edit colors</p>
        
        <div class="preview">
            <div id="no-image">No image selected</div>
            <img id="preview-img" style="max-width: 100%; max-height: 100%; display: none;">
        </div>
        
        <div class="control">
            <label>Exposure <span id="exposure-val" class="value">0</span></label>
            <input type="range" id="exposure" min="-100" max="100" value="0">
        </div>
        
        <div class="control">
            <label>Contrast <span id="contrast-val" class="value">0</span></label>
            <input type="range" id="contrast" min="-100" max="100" value="0">
        </div>
        
        <div class="control">
            <label>Saturation <span id="saturation-val" class="value">0</span></label>
            <input type="range" id="saturation" min="-100" max="100" value="0">
        </div>
        
        <div class="buttons">
            <button id="reset">Reset All</button>
            <button id="apply" disabled>Apply to Image</button>
        </div>
        
        <div id="status">Ready</div>
    </div>

    <script>
        console.log('Image Editor Plugin loaded');
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM ready');
            
            // Setup sliders
            setupSlider('exposure', 'exposure-val');
            setupSlider('contrast', 'contrast-val');
            setupSlider('saturation', 'saturation-val');
            
            // Buttons
            document.getElementById('reset').addEventListener('click', resetAll);
            document.getElementById('apply').addEventListener('click', applyChanges);
            
            // Notify Penpot we're ready
            if (window.parent) {
                window.parent.postMessage({ type: 'plugin-ready', name: 'Image Editor' }, '*');
                console.log('Sent ready message to Penpot');
            }
            
            updateStatus('âœ… Plugin loaded - select an image in Penpot');
        });
        
        // Slider setup
        function setupSlider(sliderId, valueId) {
            const slider = document.getElementById(sliderId);
            const value = document.getElementById(valueId);
            
            slider.addEventListener('input', function() {
                value.textContent = this.value;
                updatePreview();
            });
        }
        
        // Update preview
        function updatePreview() {
            const img = document.getElementById('preview-img');
            if (img.style.display !== 'none') {
                const exposure = document.getElementById('exposure').value;
                const contrast = document.getElementById('contrast').value;
                const saturation = document.getElementById('saturation').value;
                
                const filter = `
                    brightness(${1 + exposure/100})
                    contrast(${1 + contrast/100})
                    saturate(${1 + saturation/100})
                `;
                img.style.filter = filter;
            }
        }
        
        // Reset all
        function resetAll() {
            document.getElementById('exposure').value = 0;
            document.getElementById('contrast').value = 0;
            document.getElementById('saturation').value = 0;
            
            document.getElementById('exposure-val').textContent = '0';
            document.getElementById('contrast-val').textContent = '0';
            document.getElementById('saturation-val').textContent = '0';
            
            updatePreview();
            updateStatus('All settings reset');
        }
        
        // Apply changes
        function applyChanges() {
            updateStatus('Applying changes...');
            // Here you would send the changes to Penpot
            setTimeout(() => {
                updateStatus('âœ… Changes applied!');
            }, 1000);
        }
        
        // Update status
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
            console.log('Status:', message);
        }
        
        // Listen to Penpot messages
        window.addEventListener('message', function(event) {
            if (event.source !== window.parent) return;
            
            console.log('Message from Penpot:', event.data);
            
            if (event.data.type === 'selection') {
                handleSelection(event.data.data);
            }
        });
        
        // Handle selection
        function handleSelection(selection) {
            console.log('Selection:', selection);
            
            const noImage = document.getElementById('no-image');
            const previewImg = document.getElementById('preview-img');
            const applyBtn = document.getElementById('apply');
            
            if (selection && selection.length === 1 && selection[0].type === 'image') {
                noImage.style.display = 'none';
                previewImg.style.display = 'block';
                applyBtn.disabled = false;
                previewImg.src = 'https://via.placeholder.com/208x208/2680eb/ffffff?text=Image+Selected';
                resetAll();
                updateStatus('âœ… Image selected - adjust colors');
            } else {
                noImage.style.display = 'block';
                previewImg.style.display = 'none';
                applyBtn.disabled = true;
                updateStatus('Select an image in Penpot');
            }
        }
    </script>
</body>
</html>
