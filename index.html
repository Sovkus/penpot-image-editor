<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Image Editor</title>
    <style>
        /* Весь CSS из предыдущей версии оставляем без изменений */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; }
        body { padding: 16px; min-width: 400px; user-select: none; }
        .container { display: flex; gap: 20px; align-items: flex-start; }
        .preview-section { flex-shrink: 0; }
        .preview-container { width: 208px; height: 208px; border-radius: 8px; overflow: hidden; display: flex; align-items: center; justify-content: center; margin-bottom: 16px; position: relative; }
        .preview-image { max-width: 100%; max-height: 100%; object-fit: contain; filter: none; transition: filter 0.2s ease; }
        .no-image { color: var(--text-secondary); text-align: center; padding: 20px; font-size: 14px; }
        .controls-section { flex: 1; min-width: 200px; }
        .control-group { margin-bottom: 16px; }
        .control-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .control-label { font-size: 12px; font-weight: 500; color: var(--text-primary); text-transform: uppercase; letter-spacing: 0.5px; }
        .control-value { font-size: 12px; color: var(--text-secondary); min-width: 40px; text-align: right; }
        .slider-container { position: relative; height: 24px; }
        input[type="range"] { width: 100%; height: 4px; -webkit-appearance: none; background: var(--slider-track); border-radius: 2px; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; border-radius: 50%; background: var(--primary); cursor: pointer; border: 2px solid var(--background); box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        input[type="range"]::-moz-range-thumb { width: 16px; height: 16px; border-radius: 50%; background: var(--primary); cursor: pointer; border: 2px solid var(--background); box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        .buttons { display: flex; gap: 8px; margin-top: 24px; }
        button { flex: 1; padding: 10px 16px; border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; }
        .apply-btn { background: var(--primary); color: white; }
        .apply-btn:hover { opacity: 0.9; }
        .apply-btn:disabled { background: var(--disabled); cursor: not-allowed; }
        .reset-btn { background: var(--secondary); color: var(--text-primary); }
        .reset-btn:hover { background: var(--secondary-hover); }
        .error-message { color: var(--danger); font-size: 12px; margin-top: 8px; text-align: center; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="preview-section">
            <div class="preview-container" id="previewContainer">
                <img id="previewImage" class="preview-image" alt="Preview">
                <div id="noImage" class="no-image">Select an image in Penpot</div>
            </div>
        </div>
        
        <div class="controls-section">
            <!-- Все ползунки оставляем как были -->
            <div class="control-group">
                <div class="control-header">
                    <span class="control-label">Exposure</span>
                    <span class="control-value" id="exposureValue">0</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="exposure" min="-100" max="100" value="0" step="1">
                </div>
            </div>
            
            <!-- Остальные ползунки (contrast, saturation, temperature, tint, highlights, shadows) -->
            <!-- ... -->
            
            <div class="buttons">
                <button id="resetBtn" class="reset-btn">Reset All</button>
                <button id="applyBtn" class="apply-btn" disabled>Apply to Image</button>
            </div>
            
            <div id="errorMessage" class="error-message"></div>
        </div>
    </div>
    
    <script>
        // Встроенный скрипт для немедленного выполнения
        console.log("Plugin HTML loaded");
        
        // Добавляем обработчики DOMContentLoaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM Content Loaded in plugin");
            
            // Экспортируем функции для plugin.js
            window.pluginReady = true;
            
            // Инициализируем базовые CSS переменные
            const root = document.documentElement;
            root.style.setProperty('--background', '#FFFFFF');
            root.style.setProperty('--text-primary', '#000000');
            root.style.setProperty('--primary', '#2680EB');
        });
    </script>
    
    <!-- Подключаем основной скрипт ВНЕШНИМ файлом -->
    <script src="plugin.js"></script>
    <script>
    // Инициализация базовых стилей
    document.addEventListener('DOMContentLoaded', function() {
        console.log("Plugin HTML loaded");
        
        // Устанавливаем базовые CSS переменные
        const root = document.documentElement;
        const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        
        if (isDark) {
            root.style.setProperty('--background', '#1F1F1F');
            root.style.setProperty('--text-primary', '#FFFFFF');
            root.style.setProperty('--text-secondary', '#A0A0A0');
        } else {
            root.style.setProperty('--background', '#FFFFFF');
            root.style.setProperty('--text-primary', '#000000');
            root.style.setProperty('--text-secondary', '#666666');
        }
        
        root.style.setProperty('--primary', '#2680EB');
        root.style.setProperty('--danger', '#E5484D');
        
        // Устанавливаем фон контейнера предпросмотра
        const previewContainer = document.getElementById('previewContainer');
        if (previewContainer) {
            previewContainer.style.backgroundColor = getComputedStyle(root).getPropertyValue('--background');
        }
    });
</script>
</body>
</html>
